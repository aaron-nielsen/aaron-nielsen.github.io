---
title: "aaron's metamusic project: genre analysis"

date: "Updated: `r format(Sys.time(),'%b %d, %Y (%R %Z)')`"
output:
  html_document:
    theme: yeti
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# About
Since February 2018, I have been documenting all music albums that I've listened to. The following tables document how many albums I've listened to in various genres (MyCount), how many albums are documented to belong to that genre (PopCount), and the likelihood ratio (LR), where LR > 1 means I listen to the genre more than expected based on the number of albums in the genre and LR < 1 means I listen to the genre less than expected. Data is collected from RateYourMusic.com.

```{css, echo = FALSE}
caption {
      font-weight: bold;
      font-size: 2.0em;
    }
```

```{r definition, echo = FALSE, message=F, warning=F}
gen_kable_table = function(name){
  library(kableExtra)
  library(readr)
  library(dplyr)
  library(RColorBrewer)
  library(gt)
  round_dig = 2
  my_genre_data <- read_csv("my_genre_data.csv")
  g2 = my_genre_data
  g = name
  if(g == "All"){
    top = g2
  } else {
  top = g2[g2$Parent==g,] 
  }
  
  top$MyPerc = top$MyCount/sum(top$MyCount)
  top$PopPerc = top$PopCount/sum(top$PopCount)
  top$DiffPerc = top$MyPerc - top$PopPerc
  top$LR = round(top$MyPerc/top$PopPerc,2)
  top = top %>% select(-Parent) %>% arrange(desc(MyPerc),desc(-DiffPerc)) %>% select(-MyPerc) %>% select(-PopPerc) %>% select(-DiffPerc)
  top = unique(top)
  if(g == "All"){
    top = top %>% slice_head(n=500)
  }
  my_colors = brewer.pal(5, "RdYlGn")
  my_colors = rev(my_colors)
  my_colors = adjust_luminance(my_colors, 1)
  LRcol = rep(my_colors[5],length(top$Genre))
  LRcol[top$LR > 0.2] = my_colors[4]
  LRcol[top$LR > 0.5] = my_colors[3]
  LRcol[top$LR > 2] = my_colors[2]
  LRcol[top$LR > 5] = my_colors[1]
  
  top = top %>% mutate(MyCount=paste0('[',MyCount,'](','https://rateyourmusic.com/collection/adnielsen/strm_h/',gsub(" ","+",Genre),')',sep=''))
  top = top %>% mutate(PopCount=paste0('[',PopCount,'](','https://rateyourmusic.com/charts/popular/album/all-time/g:',gsub(" ","-",Genre),'/excl:ratings/',')',sep=''))
  top = top %>% mutate(Genre=paste0('[',Genre,'](','https://rateyourmusic.com/genre/',gsub(" ","+",Genre),')',sep=''))
  
  top %>% kbl(booktabs=T,format = "html", escape = FALSE,align=c('l',rep('c', 3)),caption=) %>%
    kable_styling(bootstrap_options = c("striped", "hover")) %>%
    column_spec(4, color = "black", background = LRcol)
}
```


# Parent Genres
```{r, echo=FALSE,message=FALSE,warning=F}
gen_kable_table("Top")
```

-----

# Genres Most Listened To (by Count)

```{r top1, echo = FALSE, message = FALSE, warning=FALSE}
  library(kableExtra)
  library(readr)
  library(dplyr)
  library(RColorBrewer)
  library(gt)
  round_dig = 2
  my_genre_data <- read_csv("my_genre_data.csv")
  g2 = my_genre_data
  g = "All"
  if(g == "All"){
    top = g2
  } else {
  top = g2[g2$Parent==g,] 
  }
  
  top$MyPerc = top$MyCount/sum(top$MyCount)
  top$PopPerc = top$PopCount/sum(top$PopCount)
  top$DiffPerc = top$MyPerc - top$PopPerc
  top$LR = round(top$MyPerc/top$PopPerc,2)
  top = top %>% select(-Parent) %>% arrange(desc(MyPerc),desc(-DiffPerc)) %>% select(-MyPerc) %>% select(-PopPerc) %>% select(-DiffPerc)
  top = unique(top)
  if(g == "All"){
    top = top %>% slice_head(n=20)
  }
  my_colors = brewer.pal(5, "RdYlGn")
  my_colors = rev(my_colors)
  my_colors = adjust_luminance(my_colors, 1)
  LRcol = rep(my_colors[5],length(top$Genre))
  LRcol[top$LR > 0.2] = my_colors[4]
  LRcol[top$LR > 0.5] = my_colors[3]
  LRcol[top$LR > 2] = my_colors[2]
  LRcol[top$LR > 5] = my_colors[1]
  
  top = top %>% mutate(MyCount=paste0('[',MyCount,'](','https://rateyourmusic.com/collection/adnielsen/strm_h/',gsub(" ","+",Genre),')',sep=''))
  top = top %>% mutate(PopCount=paste0('[',PopCount,'](','https://rateyourmusic.com/charts/popular/album/all-time/g:',gsub(" ","-",Genre),'/excl:ratings/',')',sep=''))
  top = top %>% mutate(Genre=paste0('[',Genre,'](','https://rateyourmusic.com/genre/',gsub(" ","+",Genre),')',sep=''))
  
  top %>% kbl(booktabs=T,format = "html", escape = FALSE,align=c('l',rep('c', 3)),caption=) %>%
    kable_styling(bootstrap_options = c("striped", "hover")) %>%
    column_spec(4, color = "black", background = LRcol)
```


# Genres Most Listened To (by LR)

```{r top2, echo = FALSE, message = FALSE, warning=FALSE}
  library(kableExtra)
  library(readr)
  library(dplyr)
  library(RColorBrewer)
  library(gt)
  round_dig = 2
  my_genre_data <- read_csv("my_genre_data.csv")
  g2 = my_genre_data
  g = "All"
  if(g == "All"){
    top = g2
  } else {
  top = g2[g2$Parent==g,] 
  }
  
  top$MyPerc = top$MyCount/sum(top$MyCount)
  top$PopPerc = top$PopCount/sum(top$PopCount)
  top$DiffPerc = top$MyPerc - top$PopPerc
  top$LR = round(top$MyPerc/top$PopPerc,2)
  top = top[top$MyCount>14,]
  top = top %>% select(-Parent) %>% arrange(desc(LR)) %>% select(-MyPerc) %>% select(-PopPerc) %>% select(-DiffPerc)
  top = unique(top)
  if(g == "All"){
    top = top %>% slice_head(n=20)
  }
  my_colors = brewer.pal(5, "RdYlGn")
  my_colors = rev(my_colors)
  my_colors = adjust_luminance(my_colors, 1)
  LRcol = rep(my_colors[5],length(top$Genre))
  LRcol[top$LR > 0.2] = my_colors[4]
  LRcol[top$LR > 0.5] = my_colors[3]
  LRcol[top$LR > 2] = my_colors[2]
  LRcol[top$LR > 5] = my_colors[1]
  
  top = top %>% mutate(MyCount=paste0('[',MyCount,'](','https://rateyourmusic.com/collection/adnielsen/strm_h/',gsub(" ","+",Genre),')',sep=''))
  top = top %>% mutate(PopCount=paste0('[',PopCount,'](','https://rateyourmusic.com/charts/popular/album/all-time/g:',gsub(" ","-",Genre),'/excl:ratings/',')',sep=''))
  top = top %>% mutate(Genre=paste0('[',Genre,'](','https://rateyourmusic.com/genre/',gsub(" ","+",Genre),')',sep=''))
  
  top %>% kbl(booktabs=T,format = "html", escape = FALSE,align=c('l',rep('c', 3)),caption=) %>%
    kable_styling(bootstrap_options = c("striped", "hover")) %>%
    column_spec(4, color = "black", background = LRcol)
```


# Genres Least Listened To (by Count)

```{r top4, echo = FALSE, message = FALSE, warning=FALSE}
  library(kableExtra)
  library(readr)
  library(dplyr)
  library(RColorBrewer)
  library(gt)
  round_dig = 2
  my_genre_data <- read_csv("my_genre_data.csv")
  g2 = my_genre_data
  g = "All"
  if(g == "All"){
    top = g2
  } else {
  top = g2[g2$Parent==g,] 
  }
  
  top$MyPerc = top$MyCount/sum(top$MyCount)
  top$PopPerc = top$PopCount/sum(top$PopCount)
  top$DiffPerc = top$MyPerc - top$PopPerc
  top$LR = round(top$MyPerc/top$PopPerc,2)
  top = top[top$MyCount == 0,]
  top = top %>% select(-Parent) %>% arrange(desc(PopCount)) %>% select(-MyPerc) %>% select(-PopPerc) %>% select(-DiffPerc)
  top = unique(top)
  if(g == "All"){
    top = top %>% slice_head(n=20)
  }
  my_colors = brewer.pal(5, "RdYlGn")
  my_colors = rev(my_colors)
  my_colors = adjust_luminance(my_colors, 1)
  LRcol = rep(my_colors[5],length(top$Genre))
  LRcol[top$LR > 0.2] = my_colors[4]
  LRcol[top$LR > 0.5] = my_colors[3]
  LRcol[top$LR > 2] = my_colors[2]
  LRcol[top$LR > 5] = my_colors[1]
  
  top = top %>% mutate(MyCount=paste0('[',MyCount,'](','https://rateyourmusic.com/collection/adnielsen/strm_h/',gsub(" ","+",Genre),')',sep=''))
  top = top %>% mutate(PopCount=paste0('[',PopCount,'](','https://rateyourmusic.com/charts/popular/album/all-time/g:',gsub(" ","-",Genre),'/excl:ratings/',')',sep=''))
  top = top %>% mutate(Genre=paste0('[',Genre,'](','https://rateyourmusic.com/genre/',gsub(" ","+",Genre),')',sep=''))
  
  top %>% kbl(booktabs=T,format = "html", escape = FALSE,align=c('l',rep('c', 3)),caption=) %>%
    kable_styling(bootstrap_options = c("striped", "hover")) %>%
    column_spec(4, color = "black", background = LRcol)
```

# Genres Least Listened To (by LR)

```{r top3, echo = FALSE, message = FALSE, warning=FALSE}
  library(kableExtra)
  library(readr)
  library(dplyr)
  library(RColorBrewer)
  library(gt)
  round_dig = 2
  my_genre_data <- read_csv("my_genre_data.csv")
  g2 = my_genre_data
  g = "All"
  if(g == "All"){
    top = g2
  } else {
  top = g2[g2$Parent==g,] 
  }
  
  top$MyPerc = top$MyCount/sum(top$MyCount)
  top$PopPerc = top$PopCount/sum(top$PopCount)
  top$DiffPerc = top$MyPerc - top$PopPerc
  top$LR = round(top$MyPerc/top$PopPerc,2)
  top = top[top$MyCount>0,]
  top = top %>% select(-Parent) %>% arrange(desc(-LR)) %>% select(-MyPerc) %>% select(-PopPerc) %>% select(-DiffPerc)
  top = unique(top)
  if(g == "All"){
    top = top %>% slice_head(n=20)
  }
  my_colors = brewer.pal(5, "RdYlGn")
  my_colors = rev(my_colors)
  my_colors = adjust_luminance(my_colors, 1)
  LRcol = rep(my_colors[5],length(top$Genre))
  LRcol[top$LR > 0.2] = my_colors[4]
  LRcol[top$LR > 0.5] = my_colors[3]
  LRcol[top$LR > 2] = my_colors[2]
  LRcol[top$LR > 5] = my_colors[1]
  
  top = top %>% mutate(MyCount=paste0('[',MyCount,'](','https://rateyourmusic.com/collection/adnielsen/strm_h/',gsub(" ","+",Genre),')',sep=''))
  top = top %>% mutate(PopCount=paste0('[',PopCount,'](','https://rateyourmusic.com/charts/popular/album/all-time/g:',gsub(" ","-",Genre),'/excl:ratings/',')',sep=''))
  top = top %>% mutate(Genre=paste0('[',Genre,'](','https://rateyourmusic.com/genre/',gsub(" ","+",Genre),')',sep=''))
  
  top %>% kbl(booktabs=T,format = "html", escape = FALSE,align=c('l',rep('c', 3)),caption=) %>%
    kable_styling(bootstrap_options = c("striped", "hover")) %>%
    column_spec(4, color = "black", background = LRcol)
```

-----


# Release Year Histogram
```{r hist, echo = FALSE, message = FALSE, warning=FALSE}
library(ggplot2)
library(readr)
my_year_data <- read_csv("my_year_data.csv")
my_year_data$`Release Year` = my_year_data$x
ggplot(my_year_data, aes(x=`Release Year`)) + 
  geom_histogram(binwidth=1) + 
  theme(axis.text=element_text(size=14),
        axis.title=element_text(size=16,face="bold"))

ggplot(my_year_data, aes(x=`Release Year`)) +
  geom_histogram(binwidth=1, fill="#69b3a2", color="#e9ecef", alpha=0.9) +
  geom_density(aes(y=1 * ..count..),alpha=0.1, fill="gray") +
  scale_x_continuous(name="Year", breaks = seq(1900,2025,10)) +
  scale_y_continuous(name="Count")

ggplot(my_year_data, aes(x=`Release Year`)) +
  geom_histogram(binwidth=5, fill="#69b3a2", color="#e9ecef", alpha=0.9) +
  geom_density(aes(y=5 * ..count..),alpha=0.1, fill="gray") +
  scale_x_continuous(name="Year", breaks = seq(1900,2025,10)) +
  scale_y_continuous(name="Count")

ggplot(my_year_data, aes(x=`Release Year`)) +
  geom_histogram(binwidth=10, fill="#69b3a2", color="#e9ecef", alpha=0.9) +
  geom_density(aes(y=10 * ..count..),alpha=0.1, fill="gray") +
  scale_x_continuous(name="Year", breaks = seq(1900,2025,10)) +
  scale_y_continuous(name="Count")


```
